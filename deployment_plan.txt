# Pick6 College Football - AWS Production Deployment Plan

## ğŸ¯ **Deployment Architecture Overview**

### **Domain Structure:**
- **Production Frontend**: `cfbpick6.com` (CloudFront + S3)
- **Production API**: `api.cfbpick6.com` (API Gateway + Lambda)
- **Dev Frontend**: `dev.cfbpick6.com` (CloudFront + S3)
- **Dev API**: `dev-api.cfbpick6.com` (API Gateway + Lambda)

### **Infrastructure Stack:**
- **Database**: Aurora Serverless v2 PostgreSQL (separate clusters for dev/prod)
- **Backend**: AWS Lambda + API Gateway (WebSocket support included)
- **Frontend**: CloudFront + S3 (global CDN, HTTPS, compression)
- **DNS**: Route 53 (already owned: cfbpick6.com)
- **CI/CD**: GitHub Actions â†’ AWS deployment
- **Monitoring**: CloudWatch + AWS Budgets + Cost Explorer

---

## ğŸ’° **Cost Analysis & Budget**

### **Monthly Cost Estimates (Low Traffic):**

#### **Development Environment:**
- Aurora Serverless v2 (0.5 ACU min): ~$40-60/month
- Lambda (1M requests): ~$2/month
- API Gateway: ~$3-5/month
- CloudFront + S3: ~$1-3/month
- Route 53: ~$1/month
- **Dev Total: ~$47-71/month**

#### **Production Environment:**
- Aurora Serverless v2 (0.5 ACU min): ~$40-60/month
- Lambda (5M requests): ~$8/month
- API Gateway: ~$15-25/month
- CloudFront + S3: ~$5-15/month
- WebSocket API: ~$1-3/month
- **Prod Total: ~$69-111/month**

#### **Combined Total: ~$116-182/month**

### **Cost Optimization Notes:**
- Aurora Serverless scales to zero during inactivity (nights/weekends)
- Lambda only charges for actual execution time
- CloudFront has generous free tier (1TB transfer, 10M requests)
- Can pause dev environment when not actively developing

---

## ğŸ—„ï¸ **Aurora Serverless Database Strategy**

### **Separate Clusters Approach (Recommended):**
```
cfbpick6-dev-cluster (us-east-1)
â”œâ”€â”€ Database: pick6db
â”œâ”€â”€ Min ACU: 0.5 (can scale to zero)
â”œâ”€â”€ Max ACU: 2.0 (burst for heavy development)
â””â”€â”€ Backup: 1 day retention

cfbpick6-prod-cluster (us-east-1)
â”œâ”€â”€ Database: pick6db
â”œâ”€â”€ Min ACU: 0.5 (always available)
â”œâ”€â”€ Max ACU: 8.0 (handle traffic spikes)
â””â”€â”€ Backup: 7 days retention + point-in-time
```

### **Why Separate Clusters:**
- âœ… Complete isolation between environments
- âœ… Independent scaling and cost management
- âœ… Dev can pause/scale to zero when unused
- âœ… Prod gets better backup/recovery policies
- âœ… Different performance requirements

### **Connection Management:**
- Aurora Serverless includes built-in connection pooling
- No need for RDS Proxy for initial launch
- Lambda functions connect directly via Data API or standard PostgreSQL

---

## ğŸŒ **Frontend Deployment: CloudFront + S3**

### **Architecture Benefits:**
- **Global Performance**: CloudFront edge locations worldwide
- **HTTPS by Default**: Free SSL certificates via AWS Certificate Manager
- **Compression**: Automatic gzip/brotli compression
- **Security**: Built-in DDoS protection, WAF integration
- **Cost-Effective**: Pay-per-use model, generous free tier

### **Build Pipeline:**
```bash
# React build optimizations
npm run build
â”œâ”€â”€ Static assets â†’ S3 bucket
â”œâ”€â”€ Index.html â†’ CloudFront (no cache)
â”œâ”€â”€ JS/CSS bundles â†’ CloudFront (1 year cache)
â””â”€â”€ Images/fonts â†’ CloudFront (1 year cache)
```

---

## ğŸ”Œ **WebSocket Support Strategy**

### **API Gateway WebSocket API:**
- **Real-time Draft Updates**: WebSocket API Gateway + Lambda
- **Connection Management**: DynamoDB table for connection tracking
- **Broadcasting**: Lambda functions send messages to all connected clients
- **Scaling**: Automatic scaling, pay-per-connection model
- **Cost**: ~$1.25 per million messages + Lambda execution

### **WebSocket Integration:**
```
wss://api.cfbpick6.com â†’ API Gateway WebSocket
â”œâ”€â”€ $connect â†’ Lambda (store connection)
â”œâ”€â”€ $disconnect â†’ Lambda (cleanup connection)
â”œâ”€â”€ message â†’ Lambda (handle draft picks)
â””â”€â”€ ping â†’ Lambda (keep-alive)
```

---

## ğŸ“‹ **Deployment Steps Checklist**

### **Phase 1: GitHub Repository Setup**
- [ ] Create GitHub repository: `pick6-college-football`
- [ ] Push existing code with proper structure:
  ```
  /backend (SAM templates + Lambdas)
  /web-app (React application)
  /infrastructure (CloudFormation templates)
  /.github/workflows (CI/CD pipelines)
  ```
- [ ] Set up GitHub Secrets for AWS credentials

### **Phase 2: AWS Certificate Manager**
- [ ] Request SSL certificates in `us-east-1` (required for CloudFront):
  ```
  *.cfbpick6.com (wildcard certificate)
  cfbpick6.com (apex domain)
  ```
- [ ] Add DNS validation records to Route 53

### **Phase 3: Aurora Serverless Clusters**
- [ ] Deploy dev cluster: `cfbpick6-dev-cluster`
- [ ] Deploy prod cluster: `cfbpick6-prod-cluster`
- [ ] Configure security groups and VPC
- [ ] Run migration scripts to set up schema
- [ ] Load initial data (schools, games)

### **Phase 4: Backend API Deployment**
- [ ] Update SAM templates for production
- [ ] Deploy dev environment: `dev-api.cfbpick6.com`
- [ ] Deploy prod environment: `api.cfbpick6.com`
- [ ] Configure environment variables and secrets
- [ ] Test all API endpoints

### **Phase 5: Frontend Deployment**
- [ ] Create S3 buckets for static hosting
- [ ] Configure CloudFront distributions
- [ ] Set up Route 53 DNS records
- [ ] Deploy dev frontend: `dev.cfbpick6.com`
- [ ] Deploy prod frontend: `cfbpick6.com`

### **Phase 6: Monitoring & Alerts**
- [ ] Set up AWS Budgets (monthly spend alerts)
- [ ] Configure CloudWatch dashboards
- [ ] Set up log aggregation and error monitoring
- [ ] Create performance monitoring alerts

---

## ğŸš€ **CI/CD Pipeline Strategy**

### **GitHub Actions Workflows:**

#### **Backend Deployment:**
```yaml
# .github/workflows/backend-dev.yml
name: Deploy Backend to Dev
on:
  push:
    branches: [develop]
    paths: ['backend/**']
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Configure AWS
      - name: SAM Build & Deploy
      - name: Run Tests
```

#### **Frontend Deployment:**
```yaml
# .github/workflows/frontend-prod.yml
name: Deploy Frontend to Production
on:
  push:
    branches: [main]
    paths: ['web-app/**']
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build React App
      - name: Deploy to S3
      - name: Invalidate CloudFront
```

### **Branching Strategy:**
- `main` â†’ Production deployments
- `develop` â†’ Dev environment deployments
- `feature/*` â†’ Manual testing only

---

## ğŸ“Š **Monitoring & Cost Management**

### **AWS Budgets Setup:**
```yaml
Budgets:
  - Name: "Pick6 Monthly Budget"
    Amount: $200
    Alerts:
      - 50% threshold: Email notification
      - 80% threshold: Email + Slack notification
      - 100% threshold: Email + Slack + SMS
```

### **Key Metrics to Monitor:**
- **Database**: ACU usage, connections, query performance
- **Lambda**: Invocations, duration, errors, cold starts
- **API Gateway**: Request count, latency, 4xx/5xx errors
- **CloudFront**: Cache hit ratio, origin requests, bandwidth
- **WebSocket**: Connected users, message volume

### **Cost Optimization Alerts:**
- Aurora ACU usage spikes
- Lambda timeout increases (indicating performance issues)
- CloudFront cache miss ratio (indicates inefficient caching)
- Unusually high API Gateway request volume

---

## ğŸ”§ **Updated CloudFormation Templates**

### **Template Structure:**
```
infrastructure/
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ certificates.yaml     # SSL certificates
â”‚   â”œâ”€â”€ route53.yaml         # DNS management
â”‚   â””â”€â”€ budgets.yaml         # Cost monitoring
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ aurora-dev.yaml      # Dev cluster
â”‚   â””â”€â”€ aurora-prod.yaml     # Prod cluster
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ api-dev.yaml         # Dev API Gateway + Lambdas
â”‚   â””â”€â”€ api-prod.yaml        # Prod API Gateway + Lambdas
â””â”€â”€ frontend/
    â”œâ”€â”€ cloudfront-dev.yaml  # Dev CloudFront + S3
    â””â”€â”€ cloudfront-prod.yaml # Prod CloudFront + S3
```

---

## ğŸ¯ **Next Immediate Actions**

### **1. Create GitHub Repository**
```bash
cd /Users/mitchmacknight/ios_pick6
git init
git remote add origin https://github.com/yourusername/pick6-college-football.git
```

### **2. Request SSL Certificates**
- Go to AWS Certificate Manager (us-east-1)
- Request: `*.cfbpick6.com` and `cfbpick6.com`
- Add DNS validation records to Route 53

### **3. Set Up Cost Monitoring**
- Create AWS Budget for $200/month
- Set up billing alerts at 50%, 80%, 100%

### **4. Deploy Aurora Clusters**
- Start with dev cluster for testing
- Migrate existing PostgreSQL schema
- Test connectivity and performance

---

## ğŸš¨ **Security Considerations**

### **Production Security:**
- [ ] WAF rules for CloudFront (SQL injection, XSS protection)
- [ ] VPC security groups (database access only from Lambda)
- [ ] JWT secret rotation strategy
- [ ] API rate limiting (prevent abuse)
- [ ] CORS policies (restrict to your domains only)

### **Environment Separation:**
- [ ] Separate IAM roles for dev/prod
- [ ] Different JWT secrets per environment
- [ ] Database access restrictions
- [ ] CloudFormation stack naming conventions

---

## ğŸ“ˆ **Scaling Strategy**

### **Phase 1 (Launch)**: Current setup handles ~1,000 users
### **Phase 2 (Growth)**: Add RDS Proxy, increase Aurora ACU limits
### **Phase 3 (Scale)**: Consider ECS/Fargate for heavy workloads
### **Phase 4 (Enterprise)**: Multi-region deployment, advanced caching

---

**This deployment plan balances professional infrastructure with cost-consciousness, perfect for a learning project that can scale to real users! ğŸš€**

Ready to start with GitHub repository setup and SSL certificate creation?
